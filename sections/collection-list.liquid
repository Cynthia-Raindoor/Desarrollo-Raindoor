{{ 'section-collection-list.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{% liquid
  assign total_blocks = section.blocks.size

  # Lógica para definir qué tipo de diseño usar
  assign is_large_slider = false
  assign is_strict_grid = false

  if total_blocks > 4
    assign is_large_slider = true
  elsif total_blocks < 3
    # Si hay 1 o 2 items, activamos el modo "Estricto" (sin slider)
    assign is_strict_grid = true
  endif
%}

{%- style -%}
  a.click__card_collection {
      display: block !important;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
  }
        .collection-list__description{
          margin-bottom:2rem;
        }
          .section-{{ section.id }}-padding {
            padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
            padding-bottom: {{ section.settings.padding_bottom | times: 0.2 | round: 0 }}px;

          }

          @media screen and (min-width: 750px) {
            .section-{{ section.id }}-padding {
              padding-top: {{ section.settings.padding_top }}px;
              padding-bottom: {{ section.settings.padding_bottom | times: 0.2 | round: 0 }}px;

            }
          }

          /* Estilos generales */
          
          .custom_collection{{ section.id }} .icon-wrap { display: none; }
          .custom_collection{{ section.id }} .card__media {
            border-radius: 5px !important;
            overflow: hidden !important;
          }
       .custom_collection{{ section.id }} .card__inner {
            --ratio-percent: 150% !important; /* Ajusta ALTURA */
          }
          .custom_collection{{ section.id }} .card__media img {
            object-fit: cover !important; /* RELLENAR TODO EL ESPACIO*/
          }
          .custom_collection{{ section.id }} .card__heading a {
            font-size: 1.4rem;
            font-weight: 700;
          }
          
          .custom_collection{{ section.id }} p {
            padding: 0;
            margin: 0;
            font-size: 1.2rem;
          }

          /* FIX SPACING: FORCE TEXT UP */
          .custom_collection{{ section.id }} .card__content {
             margin-top: 40px !important; 
             padding-top: 0 !important;
             display: block !important;
             width: 100%;
          }
          .custom_collection{{ section.id }} .card__information,
          .custom_collection{{ section.id }} .card__heading {
             margin-top: 0 !important;
             padding-top: 0 !important;
          }

          .custom_collection{{ section.id }} slider-component {
            display: flex;
            align-items: center;
            gap: 5px;
          }

          .custom_collection{{ section.id }} .slider-button--prev {
               left:1rem;
          }
          .custom_collection{{ section.id }} .slider-button--next {
            right: 1rem;
          }
          .custom_collection{{ section.id }} .slider-button {
          color: rgba(var(--color-foreground), .75);
          border: none;
          cursor: pointer;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
          position: absolute;
          top: 35%;
          transform: translate(0, 50%);
          z-index: 5;
          background: white;
          border-radius: 50%;
      }
          /*
             MODO 1: GRID ESTÁTICO (Para 3 o 4 items en Desktop)
          */
          @media (min-width: 750px) {
            .custom_collection{{ section.id }}.static-grid .collection-list {
              display: grid;
              grid-template-columns: repeat({{ section.blocks.size }}, 1fr);
              gap: 3rem;
            }
            .custom_collection{{ section.id }}.static-grid .slider-button {
              display: none !important;
            }
          }

          /*
             MODO 2: SLIDER MÓVIL (Para 3 o 4 items)
             Solo aplica si NO es strict-grid
          */
          @media (max-width: 749px) {

  .custom_collection{{ section.id }} .card__information{
    padding-bottom:0;
  }
             .custom_collection{{ section.id }} .card__heading {
  min-height: auto;
             }
            .custom_collection{{ section.id }} .slider-button {

          top: 30%;

      }

            .custom_collection{{ section.id }} {
              padding: 0 1.5rem !important;
            }


            /* Comportamiento slider móvil normal */
            .custom_collection{{ section.id }}.static-grid:not(.strict-grid) .collection-list {
              display: flex;
              flex-wrap: nowrap;
              overflow-x: auto;
              scroll-snap-type: x mandatory;
              gap: 1rem;
              padding-bottom: 1rem;
              margin: 0;
              scroll-behavior: smooth;
            }

            .custom_collection{{ section.id }}.static-grid:not(.strict-grid) .collection-list li {
              min-width: 35%;
              max-width: 35%;
              scroll-snap-align: start;
              width: 35% !important;
            }
          }

          /*
             NUEVO: MODO ESTRICTO (1 o 2 Items)
             Esto anula el slider en móvil y fuerza el grid
          */
          .custom_collection{{ section.id }}.strict-grid .collection-list {
            display: grid;
            gap: 1rem;
            /* Si es 1 item = 1fr (full), Si son 2 items = 1fr 1fr (mitad y mitad) */
            grid-template-columns: repeat({{ total_blocks }}, 1fr);
            padding-bottom: 0;
            overflow: visible;
          }

          /* Ajustes específicos para móvil en modo estricto */
          @media (max-width: 749px) {
            .custom_collection{{ section.id }}.strict-grid .collection-list {
               display: grid !important; /* Forzamos grid, matamos flex */
               overflow-x: visible !important;
            }
            .custom_collection{{ section.id }}.strict-grid .collection-list li {
               width: auto !important;
               min-width: 0 !important;
               max-width: none !important;
            }
            /* Ocultamos flechas por si acaso quedaron renderizadas */
            .custom_collection{{ section.id }}.strict-grid .slider-button {
              display: none !important;
            }
          }


          {% if is_large_slider %}
            @media screen and (min-width: 749px) {
              .custom_collection{{ section.id }} ul li { width:calc(100% / 6.5)!important; }

            }
            @media screen and (min-width: 1100px) {
              .custom_collection{{ section.id }} ul li { width:calc(100% / 7.5)!important; }

            }
          {% endif %}

          .custom_collection{{ section.id }} ul { width:100%; }
          .custom_collection{{ section.id }} ul li { width:100%; max-width:100%; }
          .custom_collection{{ section.id }} ul:after{ display:none!important; }
          .custom_collection{{ section.id }} .slider__slide:first-child,
          .custom_collection{{ section.id }} .slider__slide:last-child,
          .custom_collection{{ section.id }} .slider__slide{ margin:0!important; }
{%- endstyle -%}

<div class="page-width color-{{ section.settings.color_scheme }} gradient custom_collection{{ section.id }}{% if is_large_slider == false %} static-grid{% endif %}{% if is_strict_grid %} strict-grid{% endif %}">
  <div class="collection-list-wrapper isolate section-{{ section.id }}-padding">
    {%- unless section.settings.title == blank -%}
      <div class="title-wrapper--no-top-margin">
        <h2 class="collection-list-title inline-richtext {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
      </div>
    {%- endunless -%}

    {% if section.settings.description != blank %}
      <div class="rte collection-list__description">{{ section.settings.description }}</div>
    {% endif %}
    {%- if is_large_slider -%}
      <!-- CASO A: MÁS DE 4 ITEMS (Carrusel nativo Desktop y Mobile) -->
      <slider-component
        class="slider-mobile-gutter"
        data-autoplay="{{ section.settings.enable_autoplay }}"
        data-speed="{{ section.settings.autoplay_speed | default: 5 }}"
      >
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'accessibility.previous_slide' | t }}"
        >
          {% render 'icon-caret' %}
        </button>
        <ul
          class="collection-list grid slider slider--desktop slider--tablet grid--peek contains-card contains-card--collection collection-list--{{ total_blocks }}-items"
          id="Slider-{{ section.id }}"
          role="list"
        >
          {%- for block in section.blocks -%}
            <li
              class="collection-list__item grid__item slider__slide"
              id="Slide-{{ section.id }}-{{ forloop.index }}"
              {{ block.shopify_attributes }}
            >
              {% render 'card-collection', card_collection: block.settings.collection, media_aspect_ratio: section.settings.image_ratio, placeholder_image: 'collection-apparel-' | append: forloop.index0 | modulo: 4 | plus: 1 %}
            </li>
          {%- endfor -%}
        </ul>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'accessibility.next_slide' | t }}"
        >
          {% render 'icon-caret' %}
        </button>
      </slider-component>

    {%- elsif is_strict_grid -%}
      <!--
        CASO B: 1 O 2 ITEMS (Sin slider, solo Grid)
        Aquí eliminamos slider-component y botones para evitar scripts innecesarios
      -->
      <div class="slider-mobile-gutter">
        <ul class="collection-list grid collection-list--{{ total_blocks }}-items" role="list">
          {%- for block in section.blocks -%}
            <li class="collection-list__item grid__item" {{ block.shopify_attributes }}>
              {% render 'card-collection', card_collection: block.settings.collection, media_aspect_ratio: section.settings.image_ratio, placeholder_image: 'collection-apparel-' | append: forloop.index0 | modulo: 4 | plus: 1 %}
            </li>
          {%- endfor -%}
        </ul>
      </div>

    {%- else -%}
      <!--
        CASO C: 3 O 4 ITEMS (Tu configuración híbrida)
        Desktop: Grid estático
        Mobile: Carrusel con flechas personalizadas
      -->
      <slider-component class="slider-mobile-gutter">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'accessibility.previous_slide' | t }}"
        >
          {% render 'icon-caret' %}
        </button>

        <ul
          class="collection-list grid slider slider--mobile grid--peek collection-list--{{ total_blocks }}-items"
          id="Slider-{{ section.id }}"
          role="list"
        >
          {%- for block in section.blocks -%}
            <li
              class="collection-list__item grid__item slider__slide"
              id="Slide-{{ section.id }}-{{ forloop.index }}"
              {{ block.shopify_attributes }}
            >
              {% render 'card-collection', card_collection: block.settings.collection, media_aspect_ratio: section.settings.image_ratio, placeholder_image: 'collection-apparel-' | append: forloop.index0 | modulo: 4 | plus: 1 %}
            </li>
          {%- endfor -%}
        </ul>

        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'accessibility.next_slide' | t }}"
        >
          {% render 'icon-caret' %}
        </button>
      </slider-component>
    {%- endif -%}

    {%- if section.settings.show_view_all and total_blocks < collections.size -%}
      <div class="center collection-list-view-all">
        <a href="{{ routes.collections_url }}" class="button">{{ 'sections.collection_list.view_all' | t }}</a>
      </div>
    {%- endif -%}
  </div>
</div>
{% schema %}
{
  "name": "t:sections.collection-list.name",
  "tag": "section",
  "class": "section section-collection-list",
  "max_blocks": 15,
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "t:sections.collection-list.settings.title.default",
      "label": "t:sections.collection-list.settings.title.label"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Descripción de la sección"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.options__3.label"
        },
        {
          "value": "hxl",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "hxxl",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "h1",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "header",
      "content": "t:sections.collection-list.settings.header_layout.content"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.collection-list.settings.image_ratio.options__1.label"
        },
        {
          "value": "portrait",
          "label": "t:sections.collection-list.settings.image_ratio.options__2.label"
        },
        {
          "value": "square",
          "label": "t:sections.collection-list.settings.image_ratio.options__3.label"
        }
      ],
      "default": "square",
      "label": "t:sections.collection-list.settings.image_ratio.label"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "t:sections.collection-list.settings.columns_desktop.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "info": "t:sections.all.colors.has_cards_info",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": false,
      "label": "t:sections.collection-list.settings.show_view_all.label",
      "info": "t:sections.collection-list.settings.show_view_all.info"
    },
    {
      "type": "header",
      "content": "t:sections.collection-list.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        {
          "value": "1",
          "label": "t:sections.collection-list.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.collection-list.settings.columns_mobile.options__2.label"
        }
      ],
      "default": "1",
      "label": "t:sections.collection-list.settings.columns_mobile.label"
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": false,
      "label": "t:sections.collection-list.settings.swipe_on_mobile.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "featured_collection",
      "name": "t:sections.collection-list.blocks.featured_collection.name",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "t:sections.collection-list.blocks.featured_collection.settings.collection.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.collection-list.presets.name",
      "blocks": [
        {
          "type": "featured_collection"
        },
        {
          "type": "featured_collection"
        },
        {
          "type": "featured_collection"
        }
      ]
    }
  ]
}
{% endschema %}